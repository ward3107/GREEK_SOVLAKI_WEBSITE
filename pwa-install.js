class PWAInstallManager{constructor(){this.installPrompt=null,this.init()}init(){console.log("[PWA] Initializing..."),this.registerServiceWorker(),window.addEventListener("beforeinstallprompt",n=>{console.log("[PWA] Install prompt detected!"),n.preventDefault(),this.installPrompt=n,this.showInstallButton()}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App installed successfully"),localStorage.setItem("pwa-installed","true"),this.hideInstallButton()}),setTimeout(()=>{console.log("[PWA] Checking installability...");const n=this.checkPWAInstallability();this.installPrompt||n?(console.log("[PWA] PWA is installable, showing banner"),this.showInstallButton()):(console.log("[PWA] PWA not installable yet, showing demo banner"),this.showInstallButton())},2e3)}async registerServiceWorker(){if("serviceWorker"in navigator)try{const n=await navigator.serviceWorker.register("/sw.js");return console.log("Service Worker registered:",n),n}catch(n){console.log("Service Worker registration failed:",n)}return null}checkPWAInstallability(){const n="serviceWorker"in navigator,t=document.querySelector('link[rel="manifest"]'),e="https:"===location.protocol||"localhost"===location.hostname,a=globalThis.matchMedia("(display-mode: standalone)").matches,o=globalThis.matchMedia("(display-mode: standalone)").matches||globalThis.matchMedia("(display-mode: minimal-ui)").matches,i=navigator.standalone,s="true"===localStorage.getItem("pwa-installed");console.log("[PWA] Installability Check:",{hasServiceWorker:n,hasManifest:t,isHTTPS:e,isStandalone:a,isInWebApp:o,navigatorStandalone:i,hasAppInstalled:s,userAgent:navigator.userAgent,referrer:document.referrer});return a||o||i||s?(console.log("[PWA] App already installed, hiding banner"),!1):n&&t&&e}showInstallButton(){console.log("[PWA] Showing install button...");const n=document.getElementById("pwa-install-banner"),t=document.querySelectorAll('[id*="pwa-install"], [class*="pwa-install"]');console.log("[PWA] Existing banners found:",n),console.log("[PWA] All PWA-related elements:",t.length),t.forEach(n=>{console.log("[PWA] Removing existing banner:",n),n.remove()});const e=document.createElement("div");e.id="pwa-install-banner",e.className="pwa-install-banner",e.innerHTML='\n            <div class="pwa-banner-content">\n                <div class="pwa-banner-left">\n                    <span class="pwa-banner-icon"></span>\n                    <div class="pwa-banner-text">\n                        <strong>转拽 转 Greek Souvlaki</strong>\n                        <span>拽  专  转专!</span>\n                    </div>\n                </div>\n                <div class="pwa-banner-actions">\n                    <button class="pwa-banner-btn-close" id="pwa-close-btn">\n                        \n                    </button>\n                    <button class="pwa-banner-btn-install" id="pwa-install-btn">\n                        转拽 注砖\n                    </button>\n                </div>\n            </div>\n        ';const a=document.createElement("style");a.textContent="\n            .pwa-install-banner {\n                position: fixed !important;\n                top: 0 !important;\n                left: 0 !important;\n                right: 0 !important;\n                background: linear-gradient(135deg, rgba(30, 64, 175, 0.97) 0%, rgba(55, 48, 163, 0.97) 100%) !important;\n                color: white !important;\n                z-index: 999999 !important;\n                box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3) !important;\n                animation: slideDown 0.6s cubic-bezier(0.23, 1, 0.32, 1) !important;\n                font-family: 'Inter', 'Poppins', sans-serif !important;\n                backdrop-filter: blur(10px) !important;\n                min-height: 90px !important;\n                border-bottom: 3px solid rgba(255, 255, 255, 0.5) !important;\n                display: block !important;\n                visibility: visible !important;\n                font-size: 14px !important;\n                font-weight: 500 !important;\n            }\n\n            .pwa-banner-content {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                padding: 12px 20px;\n                max-width: 1200px;\n                margin: 0 auto;\n                gap: 20px;\n            }\n\n            .pwa-banner-left {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                flex: 1;\n            }\n\n            .pwa-banner-icon {\n                font-size: 24px;\n                animation: bounce 2s infinite;\n            }\n\n            .pwa-banner-text {\n                display: flex;\n                flex-direction: column;\n                line-height: 1.3;\n            }\n\n            .pwa-banner-text strong {\n                font-size: 16px;\n                font-weight: 600;\n            }\n\n            .pwa-banner-text span {\n                font-size: 14px;\n                opacity: 0.9;\n            }\n\n            .pwa-banner-actions {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n            }\n\n            .pwa-banner-btn-close {\n                background: rgba(255, 255, 255, 0.1);\n                border: none;\n                color: white;\n                width: 36px;\n                height: 36px;\n                border-radius: 50%;\n                cursor: pointer;\n                font-size: 18px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.3s ease;\n            }\n\n            .pwa-banner-btn-close:hover {\n                background: rgba(255, 255, 255, 0.2);\n                transform: scale(1.1);\n            }\n\n            .pwa-banner-btn-install {\n                background: white;\n                color: #1e40af;\n                border: none;\n                padding: 10px 20px;\n                border-radius: 25px;\n                font-size: 14px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                white-space: nowrap;\n            }\n\n            .pwa-banner-btn-install:hover {\n                background: #f0f0f0;\n                transform: translateY(-2px);\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n            }\n\n            @keyframes slideDown {\n                from {\n                    transform: translateY(-100%);\n                    opacity: 0;\n                }\n                to {\n                    transform: translateY(0);\n                    opacity: 1;\n                }\n            }\n\n            @keyframes bounce {\n                0%, 20%, 53%, 80%, 100% {\n                    transform: translateY(0);\n                }\n                40%, 43% {\n                    transform: translateY(-3px);\n                }\n                70% {\n                    transform: translateY(-2px);\n                }\n                90% {\n                    transform: translateY(-1px);\n                }\n            }\n\n            /* Mobile responsiveness */\n            @media (max-width: 768px) {\n                .pwa-install-banner {\n                    min-height: 120px !important;\n                    font-size: 16px !important;\n                }\n\n                .pwa-banner-content {\n                    flex-direction: column;\n                    text-align: center;\n                    padding: 20px 15px;\n                    gap: 15px;\n                }\n\n                .pwa-banner-left {\n                    flex-direction: column;\n                    gap: 10px;\n                }\n\n                .pwa-banner-icon {\n                    font-size: 28px !important;\n                }\n\n                .pwa-banner-text strong {\n                    font-size: 16px !important;\n                }\n\n                .pwa-banner-text span {\n                    font-size: 14px !important;\n                }\n\n                .pwa-banner-actions {\n                    width: 100%;\n                    justify-content: center;\n                    gap: 15px;\n                }\n\n                .pwa-banner-btn-close {\n                    width: 40px !important;\n                    height: 40px !important;\n                    font-size: 20px !important;\n                }\n\n                .pwa-banner-btn-install {\n                    flex: 1;\n                    max-width: 250px !important;\n                    padding: 12px 24px !important;\n                    font-size: 16px !important;\n                }\n            }\n\n            /* Extra small mobile devices */\n            @media (max-width: 480px) {\n                .pwa-install-banner {\n                    min-height: 140px !important;\n                }\n\n                .pwa-banner-content {\n                    padding: 25px 10px;\n                }\n            }\n\n            /* Add space for banner on body */\n            body {\n                padding-top: 0 !important;\n            }\n\n            body.has-pwa-banner {\n                padding-top: 70px !important;\n            }\n\n            @media (max-width: 768px) {\n                body.has-pwa-banner {\n                    padding-top: 110px !important;\n                }\n            }\n        ",document.head.appendChild(a),document.body.classList.add("has-pwa-banner");const o=e.querySelector("#pwa-close-btn"),i=e.querySelector("#pwa-install-btn");o&&o.addEventListener("click",()=>{this.hideInstallButton()}),i&&i.addEventListener("click",()=>{this.promptInstall()}),this.bannerElement=e,document.body.appendChild(e),globalThis.pwaManager=this,console.log("[PWA] Install button banner added to page")}hideInstallButton(){const n=document.getElementById("pwa-install-banner");n&&n.remove(),document.body.classList.remove("has-pwa-banner")}async promptInstall(){if(!this.installPrompt)return void alert("转拽   专注");const n=await this.installPrompt.prompt();this.installPrompt=null,"accepted"===n.outcome?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt")}}"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",()=>{}),window.showPWAInstallBanner=function(){window.pwaManager&&(console.log("[PWA] Manual trigger - showing install banner"),window.pwaManager.showInstallButton())};